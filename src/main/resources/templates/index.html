<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Minit 프로젝트</title>
<link rel="stylesheet" href="/css/style.css">
<style>
.post {
    width: 400px; 
    margin: 20px auto; 
    border: 1px solid #ddd; 
    border-radius: 8px; 
   	overflow : hidden; 
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); 
    background-color: #fff; 
}
.post-image-container {
    width: 100%;
    height: auto;
    max-height: 300px;
    overflow: hidden;
    position: relative;
}

.post-image {
    width: 80%;
    height: auto;
    max-height: 300px;
    object-fit: none;
    display: block;
}

</style>
</head>
<body>
<th:block th:include="common/header"></th:block>
    <div class="wrapper">
      <!--회원가입 모달창-->
      <div
        class="modal fade"
        id="loginModal"
        tabindex="-1"
        aria-labelledby="loginModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="loginModalLabel">로그인</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form>
                <div class="mb-3">
                  <label for="email" class="form-label">아이디</label>
                  <input
                    type="text"
                    class="form-control"
                    id="email"
                    placeholder="name@example.com"
                  />
                </div>
                <div class="mb-3">
                  <label for="password" class="form-label">비밀번호</label>
                  <input
                    type="password"
                    class="form-control"
                    id="password"
                    placeholder="비밀번호"
                  />
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                닫기
              </button>
              <button type="button" class="btn btn-primary">로그인</button>
            </div>
          </div>
        </div>
      </div>   
      <!--메인 컨텐츠 시작 -->
      <div class="sub1-contents">
        <a href ="javascript:void(0)" id="board">전체게시판</a>
        <a href="javascript:void(0)" id="best">인기게시판</a>
        <a href="javascript:void(0)" id="following">친구게시판</a>
      </div>
     
    
    <section>
        <div class="contents">
          <div class="main-contents">
            <p class="board-write">전체게시판</p>           
            <div class="main-contents-box" id="postContainer">
              <article class="post">
                <div class="post-header">     
                  <p class="post-meta"></p>
                </div>
                <img src="" alt="게시글 이미지" class="post-image">
                <p class="post-content"></p>
                <div class="post-footer">
                  <span class="post-comment"></span>
                  <span class="post-stat"></span>
                </div>
              </article>
              </div>
             </div>
            </div>
      </section>
      <button id="loadMore" class="btn btn-primary">더보기</button>
     
        
      <div class="sub2-contents">
        <a href="#">이자리는 광고가 들어올예정입니다.</a>
      </div>
      <div class="photoUpload">
        <ul class="nav">
          <li class="nav-item">
            <a class="uploadItem" aria-current="page" href="#">+</a>
          </li>
        </ul>
      </div>
    </div>
   
    <!--밑에 네비게이션 바-->
    <div class="bottom-navBar">
      <ul class="nav">
        <li class="nav-item">
          <a class="item" aria-current="page" href="#"
            ><i class="fa-solid fa-house"></i
          ></a>
        </li>
        <li class="nav-item">
           <a class="item" th:if="${session.user != null}" th:href="@{/feed/myPage(userFeedWriter=${session.user.userId})}"><i class="fa-solid fa-user"></i></a>
           <a class="item" th:if="${session.user ==null}" href="/"><i class="fa-solid fa-user"></i></a>
           
        
        </li>     
        <li class="nav-item">
          <a class="item" href="/text/textFeedList"><i class="fa-solid fa-newspaper"></i></a>
          <a class="item" href="#"><i class="fa-solid fa-newspaper"></i></a>
        </li>
        <li class="nav-item">
          <a class="item" href="#"><i class="fa-solid fa-camera"></i></a>
        </li>
      </ul>
    </div>
	
	
	<th:block th:include="common/footer"></th:block>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

 

 <script th:inline="javascript">
 $(document).ready(function() {
	    let offset = 0;
	    const limit = 8;
	    let allPostsLoaded = false;
	    function loadPosts() {
	        if (allPostsLoaded) return;
	        $.ajax({
	            url: '/index',
	            method: 'GET',
	            dataType: 'json',
	            data: { offset: offset, limit: limit },
	            success: function(data) {
	                console.log(data); // 서버에서 반환된 데이터를 확인
	                // 사진 리스트와 피드 리스트를 결합하고, 특정 개수만큼 잘라서 표시
	                const combinedList = [...data.photolist, ...data.feedlist];
	                const limitedList = combinedList.slice(0, limit);

	                $('#postContainer').empty();

	                limitedList.forEach(b => {
	                    const userFeedWriter = b.userFeedWriter || b.photoFeedWriter;
	                    const writerLink = `/feed/myPage?userFeedWriter=${encodeURIComponent(userFeedWriter)}`;
	                    const postHtml = `
	                    <article class="post">
	                        <div class="post-header">
	                            <a href="${writerLink}" class="post-meta-link">
	                                ${b.photoFeedWriter || b.userFeedWriter} ${b.regDate || b.createDate}
	                            </a>
	                        </div>
	                        <div class="post-image-container">
	                            <img src="/photo/${b.photoFeedImg || b.userFeedFilepath}" alt="이미지" class="post-image">
	                        </div>
	                    </article>`;

	                    $('#postContainer').append(postHtml);
	                });

	                offset += limit;
	                $(".board-write").text("전체게시판");
	            },
	            error: function(xhr, status, error) {
	                console.error('AJAX 요청 오류:', status, error);
	            }
	        });
	    }

	    // 더보기 버튼 클릭 시 게시물 로딩
	    $('#loadMore').click(function() {
        $('#loginModal').modal('show');
    });

	    // 페이지 로드 시 초기 게시물 로딩
	    loadPosts();
	});
 
 $(document).ready(function() {
	    $("#best").click(function() {
	        $.ajax({
	            url: '/best', // 실제 API 엔드포인트
	            method: 'GET',
	            dataType: 'json',
	            success: function(list) {
	            	
	                $('#postContainer').empty(); // 기존 콘텐츠를 비움

	                // for 루프를 사용하여 데이터 처리
	                for (let i = 0; i < list.length; i++) {
	                    const b = list[i]; // 현재 게시물 데이터
	                    // HTML 문자열 생성
	                    let postHtml = `
	                    	 
	                        <article class="post">
	                            <div class="post-header">
	                                <p class="post-meta">${b.photoFeedWriter} ${b.regDate}</p>
	                            </div>
	                            <div class="post-image-container">
	                                <img src="/photo/${b.photoFeedImg}" alt="이미지" class="post-image">
	                            </div>
	                            <div class="post-footer">
	                                <span class="post-comment">좋아요 ${b.totalLikes}</span>
	                            </div>
	                        </article>
	                    `;

	                    // 생성한 HTML을 DOM에 추가
	                    $('#postContainer').append(postHtml);
	                    $(".board-write").text("인기게시판");
	                }
	            },
	            error: function() {
					console.log("서버실패");
	            }
	        });
	    });

	});
 $(document).ready(function() {
	    $("#following").click(function() {

	        $.ajax({
	            url: '/following',
	            method: 'GET',
	            dataType: 'json',            
	            success: function(list) {
	                $('#postContainer').empty();
	                for (let i = 0; i < list.length; i++) {
	                    const b = list[i];
	                    console.log(list);
	                    let postHtml = `
	                    <article class="post">
	                        <div class="post-header">
	                            <p class="post-meta">${b.userFeedWriter} ${b.userFeedDate}</p>
	                        </div>
	                        <div class="post-image-container">
	                            <img src="/photo/${b.photoFeedImg}" alt="이미지" class="post-image">
	                            <span class="post-content">${b.userFeedContent}</span>
	                        </div>
	                        <div class="post-footer">
	                            <span class="post-comment">좋아요 ${b.totalLikes}</span>
	                        </div>
	                    </article>`;
	                    $('#postContainer').append(postHtml);
	                    $(".board-write").text("친구게시판");
	                }
	            },
	            error: function() {
	                console.log("서버 실패");
	            }
	        });
	    });
	});

 $(document).ready(function() {
	 $("#searchButton").click(function() {
	     let userId = $("#searchList").val();
	     let searchInput = $("#searchList").val();
	     console.log("search"+searchInput);
	     $.ajax({
	         url: '/searchList',
	         method: 'get',
	         data: { userId : userId},
	         dataType: 'json',
	         success: function(list) {
	        	 console.log(list);
	        	 $('#postContainer').empty();
	        	// 데이터 랜덤화
	                const combinedList = [...list.photolist, ...list.feedlist];
	                combinedList.sort(() => Math.random() - 0.5); 
	             
combinedList.forEach(b => {
	                    
	                    let postHtml = `
	                    <article class="post">
	                        <div class="post-header">
	                            <p class="post-meta">${b.photoFeedWriter || b.userFeedWriter} ${b.regDate || b.createDate}</p>
	                        </div>
	                        <div class="post-image-container">
	                            <img src="/photo/${b.photoFeedImg || b.userFeedFilepath}" alt="이미지" class="post-image">
	                        </div>

	                    </article>`;
	                    
	                    $('#postContainer').append(postHtml);
	                });

	                $(".board-write").text("검색결과");
	            },
	            error: function(xhr, status, error) {
	                console.error('AJAX 요청 오류:', status, error);
	            }
	     });
	 });    
 });
 
    </script>
 
  
    </body>
</html>